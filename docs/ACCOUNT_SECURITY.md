# Безопасность аккаунта

Отдельный домен **Account security**: вход, сессии, смена пароля, 2FA, привязка устройств. Не смешивать с «профилем» и верификацией; при росте — отдельная фича и при необходимости отдельные экраны.

---

## 1. Области

| Область | Описание |
|--------|----------|
| **Аутентификация** | Вход (логин/пароль, OTP), выход, восстановление доступа. |
| **Сессии** | Список активных сессий (устройство, браузер, дата), завершение сессии, «выйти везде». |
| **Пароль** | Смена пароля, политика сложности (на бэкенде), история не храним на фронте. |
| **2FA / MFA** | Двухфакторная аутентификация: привязка (TOTP, SMS, почта), отключение при необходимости. |
| **Устройства и доверие** | Список устройств, «доверенное устройство», отзыв доступа с устройства. |
| **Уведомления безопасности** | Вход с нового устройства, смена пароля, включение/отключение 2FA — опционально push/email. |

Реализация по шагам: сначала сессии и смена пароля, затем 2FA и устройства. Каждый блок можно включать в настройках «Безопасность аккаунта» без перегруза одного экрана.

---

## 2. Сессии

- **Модель:** у пользователя несколько сессий (токенов). Каждая: `id`, `device`, `browser`, `ip` (опционально), `createdAt`, `lastActiveAt`.
- **Фронт:** экран «Активные сессии»: список карточек, кнопка «Завершить» на каждой, «Завершить все кроме текущей».
- **API:** `GET /account/sessions`, `DELETE /account/sessions/:id`, `DELETE /account/sessions` (все кроме текущей). Текущую сессию помечать на фронте (по токену или флагу с бэка).

Типы в `domains/account`: например `Session`, `SessionId`. Логика и UI — в `features/account` (например `SessionList`, `RevokeSession`).

---

## 3. Пароль

- **Смена:** форма «текущий пароль», «новый пароль», «подтверждение». Валидация на фронте (длина, сложность) дублируется на бэкенде.
- **Восстановление:** отдельный поток (забыл пароль): запрос по email/телефону → ссылка или код → установка нового пароля. Не хранить и не передавать пароли в открытом виде; только хэши на бэке.
- В настройках безопасности — пункт «Сменить пароль», без смешивания с общим редактированием профиля.

---

## 4. 2FA / MFA

- **Варианты:** TOTP (приложение-аутентификатор), SMS-код, email-код. Приоритет — TOTP; SMS/email как опция или резерв.
- **Включение:** пользователь заходит в «Безопасность» → «Двухфакторная аутентификация» → привязка (QR для TOTP или привязка номера/почты). Подтверждение вторым фактором перед активацией.
- **Отключение:** только после повторной проверки (текущий пароль или код 2FA). Логировать включение/отключение для аудита (на бэке).
- Типы: `MfaMethod`, `MfaStatus`; экраны в `features/account` (Enable2FA, Disable2FA, Verify2FA).

---

## 5. Устройства и доверие

- После входа с нового устройства опционально: «Запомнить устройство» (доверенное). Список устройств показывать в «Безопасность аккаунта» с возможностью отозвать.
- Связь с сессиями: устройство ≈ сессия или группа сессий. Отзыв сессии = отзыв доступа с этого устройства.

---

## 6. Интеграция в приложение

- **Профиль / Настройки:** пункт меню «Безопасность аккаунта» или «Безопасность» → ведёт на отдельный экран или подраздел (сессии, пароль, 2FA, устройства). Не перегружать один экран — подразделы или отдельные страницы.
- **Роуты (пример):** `/profile/security`, `/profile/security/sessions`, `/profile/security/password`, `/profile/security/2fa`. Каждый маршрут — свой слайс в `features/account`, общий layout «Безопасность».
- **Языки:** ключи `account.security.*`, `account.sessions.*`, `account.password.*`, `account.2fa.*` — в i18n по домену.

Так безопасность аккаунта масштабируется (новые методы 2FA, политики паролей, уведомления) без перегруза существующих файлов и с учётом мультиязычности.
